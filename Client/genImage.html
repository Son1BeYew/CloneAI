<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EternaPicSHT Studio</title>
    <link rel="stylesheet" href="assets/css/genImage.css" />
    <link rel="stylesheet" href="/assets/css/styles.css" />
    <link rel="stylesheet" href="/assets/css/features.css" />
    <link rel="stylesheet" href="/assets/css/hero.css" />
    <link rel="stylesheet" href="/assets/css/footer.css" />
  </head>

  <body>
    <div id="header"></div>

    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button class="tab-button active" data-tab="ascii-art">
        <span class="tab-icon"></span>T·∫°o ·∫£nh c√° nh√¢n
      </button>
      <button class="tab-button" data-tab="background">
        <span class="tab-icon"></span>T·∫°o ·∫¢nh B·ªëi C·∫£nh
      </button>
      <button class="tab-button" data-tab="outfit">
        <span class="tab-icon"></span>ƒê·ªïi Trang Ph·ª•c/T√≥c
      </button>
      <button class="tab-button" data-tab="hot-trend">
        <span class="tab-icon"></span>Hot Trend
      </button>
    </div>

    <div class="container">
      <!-- ASCII Art Tab -->
      <div class="tab-content active" id="ascii-art-tab">
        <div class="content-wrapper">
          <!-- Upload Section -->
          <div class="upload-box">
            <h3>T·∫£i ·∫£nh l√™n</h3>
            <div class="upload-area" id="upload-area">
              <div class="upload-content">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/1829/1829588.png"
                  alt="upload"
                  class="upload-icon"
                />
                <p><strong>K√©o th·∫£ ho·∫∑c t·∫£i ·∫£nh t·∫°i ƒë√¢y</strong></p>
                <p class="small">ho·∫∑c nh·∫•n ƒë·ªÉ ch·ªçn t·ªáp</p>
                <input type="file" id="file-input" hidden accept="image/*" />
                <button class="btn" id="choose-btn">Ch·ªçn ·∫£nh</button>
              </div>
            </div>
          </div>
          <div class="settings-box">
            <h3>C√†i ƒë·∫∑t</h3>

            <label>Ch·∫ø ƒë·ªô ·∫£nh</label>
            <select id="prompt-select">
              <option value="">Loading prompts...</option>
            </select>

            <label>Width: 80 characters</label>
            <input type="range" min="40" max="200" value="80" />

            <label>D√°ng ƒë·ª©ng</label>
            <select>
              <option>Nghi√™ng v·ªÅ b√™n tr√°i</option>
              <option>Nghi√™ng v·ªÅ b√™n ph·∫£i</option>
              <option>Nh√¨n v·ªÅ gi·ªØa</option>
            </select>

            <button class="download-btn" id="generate-btn">
              <span></span>T·∫°o ·∫£nh
            </button>
          </div>
          <div class="output-box">
            <h3>K·∫øt qu·∫£</h3>
            <div class="output-area" id="output-area">
              <div class="output-placeholder">
                <p>·∫¢nh k·∫øt qu·∫£ s·∫Ω xu·∫•t hi·ªán t·∫°i ƒë√¢y</p>
              </div>
            </div>
            <div class="output-info" id="output-info" style="display: none">
              <p>
                <strong>Ch·∫ø ƒë·ªô:</strong> <span id="output-prompt-name"></span>
              </p>
              <p>
                <strong>M√¥ t·∫£:</strong> <span id="output-prompt-title"></span>
              </p>
            </div>
            <button
              class="download-btn download-result"
              id="download-btn"
              style="display: none"
            >
              <span>‚¨á</span>T·∫£i ·∫£nh
            </button>
          </div>
        </div>
      </div>

      <!-- Background Image Tab -->
      <div class="tab-content" id="background-tab">
        <div class="content-wrapper">
          <div class="upload-box">
            <h3>T·∫£i ·∫£nh l√™n</h3>
            <div class="upload-area" id="bg-upload-area">
              <div class="upload-content">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/1829/1829588.png"
                  alt="upload"
                  class="upload-icon"
                />
                <p><strong>K√©o th·∫£ ho·∫∑c t·∫£i ·∫£nh t·∫°i ƒë√¢y</strong></p>
                <p class="small">ho·∫∑c nh·∫•n ƒë·ªÉ ch·ªçn t·ªáp</p>
                <input type="file" id="bg-file-input" hidden accept="image/*" />
                <button class="btn" id="bg-choose-btn">Ch·ªçn ·∫£nh</button>
              </div>
            </div>
          </div>

          <div class="settings-box">
            <h3>C√†i ƒë·∫∑t</h3>

            <label>Lo·∫°i b·ªëi c·∫£nh</label>
            <select id="bg-type-select">
              <option value="">Ch·ªçn lo·∫°i b·ªëi c·∫£nh</option>
              <option value="nature">Thi√™n nhi√™n</option>
              <option value="urban">Th√†nh ph·ªë</option>
              <option value="abstract">Tr·ª´u t∆∞·ª£ng</option>
              <option value="fantasy">Gi·∫£ t∆∞·ªüng</option>
            </select>

            <label>M√¥ t·∫£ b·ªëi c·∫£nh</label>
            <textarea
              id="bg-description"
              placeholder="M√¥ t·∫£ b·ªëi c·∫£nh m√† b·∫°n mu·ªën t·∫°o..."
              rows="4"
            ></textarea>

            <button class="download-btn" id="bg-generate-btn">
              <span></span>T·∫°o B·ªëi C·∫£nh
            </button>
          </div>

          <div class="output-box">
            <h3>K·∫øt qu·∫£</h3>
            <div class="output-area" id="bg-output-area">
              <div class="output-placeholder">
                <p>·∫¢nh b·ªëi c·∫£nh s·∫Ω xu·∫•t hi·ªán t·∫°i ƒë√¢y</p>
              </div>
            </div>
            <button
              class="download-btn download-result"
              id="bg-download-btn"
              style="display: none"
            >
              <span>‚¨á</span>T·∫£i ·∫¢nh
            </button>
          </div>
        </div>
      </div>

      <!-- Outfit Tab -->
      <div class="tab-content" id="outfit-tab">
        <div class="content-wrapper">
          <div class="upload-box">
            <h3>T·∫£i ·∫£nh ng∆∞·ªùi l√™n</h3>
            <div class="upload-area" id="outfit-upload-area">
              <div class="upload-content">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/1829/1829588.png"
                  alt="upload"
                  class="upload-icon"
                />
                <p><strong>K√©o th·∫£ ho·∫∑c t·∫£i ·∫£nh t·∫°i ƒë√¢y</strong></p>
                <p class="small">ho·∫∑c nh·∫•n ƒë·ªÉ ch·ªçn t·ªáp</p>
                <input
                  type="file"
                  id="outfit-file-input"
                  hidden
                  accept="image/*"
                />
                <button class="btn" id="outfit-choose-btn">Ch·ªçn ·∫£nh</button>
              </div>
            </div>
          </div>

          <div class="upload-box">
            <h3>T·∫£i ·∫£nh qu·∫ßn √°o l√™n (T√πy ch·ªçn)</h3>
            <div class="upload-area" id="clothing-upload-area">
              <div class="upload-content">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/1829/1829588.png"
                  alt="upload"
                  class="upload-icon"
                />
                <p><strong>K√©o th·∫£ ho·∫∑c t·∫£i ·∫£nh qu·∫ßn √°o t·∫°i ƒë√¢y</strong></p>
                <p class="small">ho·∫∑c nh·∫•n ƒë·ªÉ ch·ªçn t·ªáp</p>
                <input
                  type="file"
                  id="clothing-file-input"
                  hidden
                  accept="image/*"
                />
                <button class="btn" id="clothing-choose-btn">Ch·ªçn ·∫£nh</button>
              </div>
            </div>
          </div>

          <div class="settings-box">
            <h3>C√†i ƒë·∫∑t</h3>

            <label>Gi·ªõi t√≠nh</label>
            <select id="outfit-gender-select">
              <option value="">Ch·ªçn gi·ªõi t√≠nh</option>
              <option value="male">Nam</option>
              <option value="female">N·ªØ</option>
            </select>

            <label>Lo·∫°i trang ph·ª•c/t√≥c</label>
            <select id="outfit-type-select" disabled>
              <option value="">Ch·ªçn lo·∫°i</option>
            </select>

            <label>Ki·ªÉu t√≥c</label>
            <select id="outfit-hairstyle-select" disabled>
              <option value="">Ch·ªçn ki·ªÉu t√≥c</option>
            </select>

            <label>M√¥ t·∫£ chi ti·∫øt</label>
            <textarea
              id="outfit-description"
              placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ trang ph·ª•c/t√≥c m√† b·∫°n mu·ªën..."
              rows="4"
            ></textarea>

            <button class="download-btn" id="outfit-generate-btn">
              <span></span>Thay ƒê·ªïi
            </button>
          </div>

          <div class="output-box">
            <h3>K·∫øt qu·∫£</h3>
            <div class="output-area" id="outfit-output-area">
              <div class="output-placeholder">
                <p>·∫¢nh k·∫øt qu·∫£ s·∫Ω xu·∫•t hi·ªán t·∫°i ƒë√¢y</p>
              </div>
            </div>
            <button
              class="download-btn download-result"
              id="outfit-download-btn"
              style="display: none"
            >
              <span></span>T·∫£i ·∫¢nh
            </button>
          </div>
        </div>
      </div>

      <!-- Hot Trend Tab -->
      <div class="tab-content" id="hot-trend-tab">
        <div class="content-wrapper-trends">
          <div class="trends-section">
            <h3>Nh·ªØng Phong C√°ch ƒêang Hot</h3>
            <div class="trends-grid" id="trendsGrid"></div>
          </div>

          <div
            class="trend-creator-section"
            id="trendCreatorSection"
            style="display: none"
          >
            <div class="content-wrapper">
              <!-- Upload Section -->
              <div class="upload-box">
                <h3>T·∫£i ·∫£nh l√™n</h3>
                <div class="upload-area" id="trend-upload-area">
                  <div class="upload-content">
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/1829/1829588.png"
                      alt="upload"
                      class="upload-icon"
                    />
                    <p><strong>K√©o th·∫£ ho·∫∑c t·∫£i ·∫£nh t·∫°i ƒë√¢y</strong></p>
                    <p class="small">ho·∫∑c nh·∫•n ƒë·ªÉ ch·ªçn t·ªáp</p>
                    <input
                      type="file"
                      id="trend-file-input"
                      hidden
                      accept="image/*"
                    />
                    <button class="btn" id="trend-choose-btn">Ch·ªçn ·∫£nh</button>
                  </div>
                </div>
              </div>

              <!-- Settings Section -->
              <div class="settings-box">
                <h3>C√†i ƒë·∫∑t</h3>
                <label>Phong C√°ch ƒê∆∞·ª£c Ch·ªçn</label>
                <div
                  id="trend-selected-style"
                  style="
                    padding: 10px;
                    background: #f0f0f0;
                    border-radius: 6px;
                    margin-bottom: 15px;
                    font-weight: 500;
                  "
                >
                  Ch∆∞a ch·ªçn
                </div>

                <label>M√¥ t·∫£ th√™m (t√πy ch·ªçn)</label>
                <textarea
                  id="trend-additional-desc"
                  placeholder="Th√™m m√¥ t·∫£ chi ti·∫øt ƒë·ªÉ t·∫°o ra k·∫øt qu·∫£ t·ªët h∆°n..."
                  rows="3"
                  style="margin-bottom: 15px"
                ></textarea>

                <button class="download-btn" id="trend-generate-btn">
                  <span>‚ú®</span>T·∫°o ·∫£nh
                </button>

                <button
                  class="download-btn"
                  onclick="resetTrendCreator()"
                  style="background-color: #999; margin-top: 8px"
                >
                  <span>‚Ü∫</span>Ch·ªçn Phong C√°ch Kh√°c
                </button>
              </div>

              <!-- Output Section -->
              <div class="output-box">
                <h3>K·∫øt Qu·∫£</h3>
                <div class="output-area" id="trend-output-area">
                  <div class="output-placeholder">
                    <p>·∫¢nh k·∫øt qu·∫£ s·∫Ω xu·∫•t hi·ªán t·∫°i ƒë√¢y</p>
                  </div>
                </div>
                <button
                  class="download-btn download-result"
                  id="trend-download-btn"
                  style="display: none"
                >
                  <span>‚¨á</span>T·∫£i ·∫¢nh
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="/assets/js/genImage.js"></script>

    <!-- Quick Guide Section -->
    <div class="quick-guide">
      <h3>üìñ H∆∞·ªõng d·∫´n nhanh</h3>
      <div class="guide-content">
        <p><strong>T·∫°o ASCII Art:</strong></p>
        <ol>
          <li>T·∫£i ·∫£nh - Ch·ªçn ·∫£nh ho·∫∑c k√©o th·∫£ ·∫£nh v√†o √¥ 'T·∫£i ·∫£nh'.</li>
          <li>
            Ch·∫ø ƒë·ªô ·∫£nh - H√£y nh·∫≠p m·ªôt √Ω t∆∞·ªüng ng·∫Øn g·ªçn (VD: 'm·ªôt hi·ªáp sƒ© trong
            r·ª´ng r·∫≠m').
          </li>
          <li>
            T·∫°o ·∫£nh - Nh·∫•n n√∫t 'T·∫°o ·∫£nh' ƒë·ªÉ b·∫Øt ƒë·∫ßu render (qu√° tr√¨nh n√†y m·∫•t
            v√†i ph√∫t v√¨ t√≠nh to√°n).
          </li>
          <li>
            T·∫£i v·ªÅ - Khi ho√†n th√†nh, nh·∫•n n√∫t 'T·∫£i ·∫£nh' ƒë·ªÉ t·∫£i k·∫øt qu·∫£ v·ªÅ m√°y.
          </li>
        </ol>
        <p style="margin-top: 15px"><strong>T·∫°o ·∫¢nh B·ªëi C·∫£nh:</strong></p>
        <ol>
          <li>Chuy·ªÉn sang tab 'T·∫°o ·∫¢nh B·ªëi C·∫£nh'.</li>
          <li>T·∫£i ·∫£nh ƒë·∫ßu v√†o v√† ch·ªçn lo·∫°i b·ªëi c·∫£nh.</li>
          <li>M√¥ t·∫£ chi ti·∫øt b·ªëi c·∫£nh mu·ªën t·∫°o.</li>
          <li>Nh·∫•n 'T·∫°o B·ªëi C·∫£nh' v√† ch·ªù k·∫øt qu·∫£.</li>
        </ol>
      </div>
    </div>

    <!-- Confirmation Dialog -->
    <div id="confirmDialog" class="confirm-modal hidden">
      <div class="confirm-overlay" onclick="closeConfirmDialog()"></div>
      <div class="confirm-content">
        <div class="confirm-header">
          <h3 id="confirmTitle">X√°c nh·∫≠n t·∫°o ·∫£nh</h3>
          <button class="confirm-close" onclick="closeConfirmDialog()">
            ‚úï
          </button>
        </div>
        <div class="confirm-body">
          <p id="confirmMessage">B·∫°n ch·∫Øc ch·∫Øn mu·ªën t·∫°o ·∫£nh?</p>
          <div class="price-section">
            <div class="price-row">
              <span>Gi√° ti·ªÅn:</span>
              <strong id="confirmPrice">0 VND</strong>
            </div>
            <div class="price-row">
              <span>S·ªë d∆∞ hi·ªán t·∫°i:</span>
              <strong id="confirmBalance">0 VND</strong>
            </div>
          </div>
        </div>
        <div class="confirm-actions">
          <button class="btn-cancel" onclick="closeConfirmDialog()">H·ªßy</button>
          <button class="btn-confirm" onclick="proceedGenerate()">
            X√°c nh·∫≠n
          </button>
        </div>
      </div>
    </div>

    <div id="footer"></div>
    <script src="/assets/js/config.js"></script>
    <script src="/assets/js/auth-utils.js"></script>
    <script src="/assets/js/main.js"></script>
    <script>
      // Check token on page load
      window.addEventListener('DOMContentLoaded', async () => {
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return;
        }
        // Verify token is still valid
        try {
          const res = await fetch(API_CONFIG.protected(), {
            headers: { 'Authorization': `Bearer ${token}` }
          });
          if (!res.ok) {
            localStorage.removeItem('token');
            localStorage.removeItem('refreshToken');
            window.location.href = '/login.html';
          }
        } catch (err) {
          console.error('Token verification failed:', err);
        }
      });
    </script>

    <style>
      /* Trend upload area styling */
      #trend-upload-area {
        padding: 20px 10px !important;
        min-height: 150px !important;
      }

      #trend-upload-area .upload-icon {
        width: 35px !important;
        margin-bottom: 8px !important;
      }

      #trend-upload-area .upload-content p {
        font-size: 13px !important;
        margin: 5px 0 !important;
      }

      #trend-upload-area .upload-content p.small {
        font-size: 11px !important;
      }

      #trend-upload-area .btn {
        font-size: 12px !important;
        padding: 6px 12px !important;
      }

      .login-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      .login-modal.hidden {
        display: none !important;
      }

      .modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        position: relative;
        background: white;
        border-radius: 12px;
        padding: 40px;
        max-width: 400px;
        text-align: center;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        animation: slideIn 0.3s ease;
      }

      .modal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 32px;
        cursor: pointer;
        color: #999;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background 0.2s, color 0.2s;
      }

      .modal-close:hover {
        background: #f3f4f6;
        color: #333;
      }

      .modal-icon {
        font-size: 48px;
        margin-bottom: 16px;
      }

      .modal-content h2 {
        font-size: 20px;
        color: #1f2937;
        margin: 0 0 12px 0;
      }

      .modal-content p {
        color: #6b7280;
        margin: 0 0 24px 0;
        font-size: 14px;
      }

      .modal-btn-login {
        display: inline-block;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 32px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .modal-btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>

    <script src="/assets/js/genImage.js"></script>
  </body>
</html>
