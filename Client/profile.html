<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hồ Sơ - EternaPicSHT Studio</title>
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <link rel="stylesheet" href="/assets/css/header.css" />
  <link rel="stylesheet" href="/assets/css/footer.css" />
  <link rel="stylesheet" href="/assets/css/profile.css" />
</head>

<body>
  <div id="header"></div>

  <div class="profile-container">
    <div class="profile-card">
      <div class="success-message" id="success-message"> Cập nhật hồ sơ thành công!</div>
      <div class="error-message" id="error-message"></div>

      <!-- VIEW MODE -->
      <div class="view-mode">
        <div class="profile-header">
          <div class="profile-avatar" id="view-avatar">
            <img id="avatar-img" src="/assets/images/profile.jpg" alt="Avatar" />
            <div class="avatar-overlay">
              <label for="edit-avatar" class="avatar-upload-btn">Thay đổi ảnh</label>
              <input type="file" id="edit-avatar" accept="image/*" style="display: none;" />
            </div>
          </div>

          <div class="profile-info">
            <h1 id="view-fullname">-</h1>
            <p id="view-email">-</p>
          </div>
        </div>

        <div class="profile-section">
          <div class="section-title">Thông Tin Cá Nhân</div>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Email</span>
              <span class="info-value" id="view-email-value">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Số Điện Thoại</span>
              <span class="info-value" id="view-phone">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Giới Tính</span>
              <span class="info-value" id="view-gender">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">Biệt Danh</span>
              <span class="info-value" id="view-nickname">-</span>
            </div>
          </div>
        </div>

        <div class="profile-section">
          <div class="section-title">Mạng Xã Hội</div>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Facebook</span>
              <span class="info-value" id="view-facebook">
                <a href="#" target="_blank" id="facebook-link">-</a>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Instagram</span>
              <span class="info-value" id="view-instagram">
                <a href="#" target="_blank" id="instagram-link">-</a>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">LinkedIn</span>
              <span class="info-value" id="view-linkedin">
                <a href="#" target="_blank" id="linkedin-link">-</a>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- EDIT MODE -->
      <div class="edit-mode">
        <div class="profile-section">
          <div class="section-title">Thông Tin Cá Nhân</div>

          <div class="form-group">
            <label>Họ Và Tên</label>
            <input type="text" id="edit-fullname" placeholder="Nhập họ và tên" />
          </div>

          <div class="form-group">
            <label>Email</label>
            <input type="email" id="edit-email" placeholder="Nhập email" />
          </div>

          <div class="form-group">
            <label>Số Điện Thoại</label>
            <input type="tel" id="edit-phone" placeholder="Nhập số điện thoại" />
          </div>

          <div class="form-group">
            <label>Giới Tính</label>
            <select id="edit-gender">
              <option value="other">Khác</option>
              <option value="male">Nam</option>
              <option value="female">Nữ</option>
            </select>
          </div>

          <div class="form-group">
            <label>Biệt Danh</label>
            <input type="text" id="edit-nickname" placeholder="Nhập biệt danh" />
          </div>
        </div>

        <div class="profile-section">
          <div class="section-title">Mạng Xã Hội</div>

          <div class="form-group">
            <label>Facebook</label>
            <input type="url" id="edit-facebook" placeholder="https://facebook.com/..." />
          </div>

          <div class="form-group">
            <label>Instagram</label>
            <input type="url" id="edit-instagram" placeholder="https://instagram.com/..." />
          </div>

          <div class="form-group">
            <label>LinkedIn</label>
            <input type="url" id="edit-linkedin" placeholder="https://linkedin.com/..." />
          </div>
        </div>

        <div class="button-group">
          <button class="btn-save" id="btn-save">Lưu thay đổi</button>
          <button class="btn-cancel" id="btn-cancel">Hủy</button>
        </div>
      </div>
      <div class="button-group">
        <button class="btn-edit" id="btn-edit">Sửa hồ sơ</button>
      </div>
    </div>

  </div>

  <div id="footer"></div>

  <script src="/assets/js/config.js"></script>
  <script src="/assets/js/auth-utils.js"></script>
  <script src="/assets/js/main.js"></script>
  <script src="/assets/js/profile.js"></script>
  <script>
    // Check token on page load
    window.addEventListener('DOMContentLoaded', async () => {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = '/login.html';
        return;
      }
      // Verify token is still valid
      try {
        const res = await fetch(API_CONFIG.protected());
        if (!res.ok) {
          localStorage.removeItem('token');
          localStorage.removeItem('refreshToken');
          window.location.href = '/login.html';
        }
      } catch (err) {
        console.error('Token verification failed:', err);
      }
    });
  </script>
</body>

</html>